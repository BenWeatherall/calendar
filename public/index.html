<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=utf-8">
    <title>Node.js Calendar with dhtmlxScheduler</title>
    <!-- Using dhtmlxScheduler from jsDelivr CDN - more reliable alternative -->
    <script src="https://cdn.jsdelivr.net/npm/dhtmlx-scheduler@7.2.6/codebase/dhtmlxscheduler.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dhtmlx-scheduler@7.2.6/codebase/dhtmlxscheduler.css">
    
    <style type="text/css" media="screen">
        html, body {
            margin: 0px;
            padding: 0px;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .dhx_cal_container {
            border: 1px solid #cecece;
        }
        
        .header-info {
            background: #f4f4f4;
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #cecece;
            font-size: 14px;
            color: #666;
        }
        
        #calendar-container {
            height: calc(100vh - 40px);
            margin-top: 40px;
        }
        
        /* Mini calendar icon - inherits dhx_cal_tab styling with custom icon */
        .dhx_cal_tab.minical-icon {
            position: relative;
            min-width: auto !important;
            width: auto !important;
            padding: 0 8px !important;
            color: var(--dhx-scheduler-btn-color, #537CFA);
        }
        
        .dhx_cal_tab.minical-icon::before {
            content: "";
            display: inline-block;
            width: 16px;
            height: 16px;
            /* Improved calendar icon with better details - blue outline, white background, blue grid */
            background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect x='2' y='3' width='12' height='11' rx='1' fill='white' stroke='%23537CFA' stroke-width='1.2'/%3E%3Crect x='4' y='1' width='1.5' height='3' rx='0.5' fill='%23537CFA'/%3E%3Crect x='10.5' y='1' width='1.5' height='3' rx='0.5' fill='%23537CFA'/%3E%3Cline x1='2' y1='6' x2='14' y2='6' stroke='%23537CFA' stroke-width='0.8'/%3E%3Ccircle cx='5' cy='8.5' r='0.8' fill='%23537CFA'/%3E%3Ccircle cx='8' cy='8.5' r='0.8' fill='%23537CFA'/%3E%3Ccircle cx='11' cy='8.5' r='0.8' fill='%23537CFA'/%3E%3Ccircle cx='5' cy='11.5' r='0.8' fill='%23537CFA'/%3E%3Ccircle cx='8' cy='11.5' r='0.8' fill='%23537CFA'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 16px 16px;
            vertical-align: middle;
        }
    </style>
</head>

<body onload="init();">
    <div class="header-info">
        Node.js Calendar with dhtmlxScheduler - Click to add events, drag to modify | Click calendar icon to jump to any year
    </div>
    
    <div id="calendar-container">
        <div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:100%;'>
            <div class="dhx_cal_navline">
                <div class="dhx_cal_prev_button">&nbsp;</div>
                <div class="dhx_cal_next_button">&nbsp;</div>
                <div class="dhx_cal_today_button"></div>
                <div class="dhx_cal_date"></div>
                <div class="dhx_cal_tab minical-icon" id="dhx_minical_icon" onclick="show_minical()" title="Jump to specific year/month"></div>
                <div class="dhx_cal_tab" name="day_tab"></div>
                <div class="dhx_cal_tab" name="week_tab"></div>
                <div class="dhx_cal_tab" name="month_tab"></div>
            </div>
            <div class="dhx_cal_header"></div>
            <div class="dhx_cal_data"></div>
        </div>
    </div>

    <script type="text/javascript" charset="utf-8">
        function init() {
            // Enable mini calendar extension
            scheduler.plugins({
                minical: true
            });
            
            // Initialize the scheduler with current date for better visibility
            const today = new Date();
            scheduler.init('scheduler_here', today, "month");
            
            // Configure date parsing for incoming data
            scheduler.templates.xml_date = function(value) { 
                return new Date(value); 
            };
            
            // Configure date format for outgoing data  
            scheduler.config.xml_date = "%Y-%m-%d %H:%i";
            
            // Enable creation of new events by double click
            scheduler.config.details_on_create = true;
            scheduler.config.details_on_dblclick = true;
            
            // Load data from the server
            scheduler.load("/data", "json");
            
            // Modern way to handle data processing in dhtmlxScheduler
            scheduler.createDataProcessor({
                url: "/data",
                mode: "POST"
            });
            
            // Alternative fallback for older versions
            if (typeof dataProcessor !== 'undefined') {
                var dp = new dataProcessor("/data");
                dp.init(scheduler);
                dp.setTransactionMode("POST", false);
            }
            
            console.log("Calendar initialized successfully");
        }
        
        function show_minical() {
            if (scheduler.isCalendarVisible()) {
                scheduler.destroyCalendar();
            } else {
                scheduler.renderCalendar({
                    position: "dhx_minical_icon",
                    date: scheduler._date,
                    navigation: true,
                    handler: function(date, calendar) {
                        scheduler.setCurrentView(date);
                        scheduler.destroyCalendar();
                    }
                });
            }
        }
    </script>
</body>
</html> 